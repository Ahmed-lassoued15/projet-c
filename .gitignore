#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#ifdef _WIN32
#include <windows.h>
#endif

typedef struct {
    int id;
    char nom[50];
    int capacite;
    float tarif_horaire;
    char equipements[200];
} Salle;

typedef struct {
    int id;
    char nom_client[100];
    int id_salle;
    char nom_salle[50];
    char date[11];  
    char heure_debut[6];  
    char heure_fin[6];
    int nombre_personnes;
    float tarif;
    char statut[20];
} Reservation;

typedef struct {
    int id;
    char numero[20];
    char nom_client[100];
    char nom_salle[50];
    char date[11];
    float duree;
    float montant;
    char date_emission[11];
} Facture;

Salle salles[100];
Reservation reservations[500];
Facture factures[500];
int nb_salles = 0;
int nb_reservations = 0;
int nb_factures = 0;


void clearScreen() {
    #ifdef _WIN32
        system("cls");
    #else
        system("clear");
    #endif
}

void pause_screen() {
    printf("\nAppuyez sur EntrÃ©e pour continuer...");
    getchar();
    getchar();
}

void get_current_date(char *date) {
    time_t t = time(NULL);
    struct tm *tm_info = localtime(&t);
    strftime(date, 11, "%Y-%m-%d", tm_info);
}

float calculer_duree(const char *heure_debut, const char *heure_fin) {
    int h1, m1, h2, m2;
    sscanf(heure_debut, "%d:%d", &h1, &m1);
    sscanf(heure_fin, "%d:%d", &h2, &m2);
    
    int minutes_debut = h1 * 60 + m1;
    int minutes_fin = h2 * 60 + m2;
    
    return (float)(minutes_fin - minutes_debut) / 60.0;
}

// ============================================================================
// TÃ‚CHE 1 : GESTION DES SALLES
// ============================================================================

// Fonction pour afficher toutes les salles
void afficher_salles() {
    clearScreen();
    printf("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n");
    printf("â•‘            LISTE DES SALLES DISPONIBLES                      â•‘\n");
    printf("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n");
    
    if (nb_salles == 0) {
        printf("Aucune salle enregistrÃ©e.\n");
        return;
    }
    
    for (int i = 0; i < nb_salles; i++) {
        printf("â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n");
        printf("â”‚ ID: %d\n", salles[i].id);
        printf("â”‚ Nom: %s\n", salles[i].nom);
        printf("â”‚ CapacitÃ©: %d personnes\n", salles[i].capacite);
        printf("â”‚ Tarif horaire: %.2f TND\n", salles[i].tarif_horaire);
        printf("â”‚ Ã‰quipements: %s\n", salles[i].equipements);
        printf("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n");
    }
}

// Fonction pour ajouter une nouvelle salle
void ajouter_salle() {
    clearScreen();
    printf("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n");
    printf("â•‘                AJOUTER UNE NOUVELLE SALLE                     â•‘\n");
    printf("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n");
    
    if (nb_salles >= 100) {
        printf("âŒ Limite de salles atteinte!\n");
        pause_screen();
        return;
    }
    
    Salle nouvelle_salle;
    nouvelle_salle.id = nb_salles + 1;
    
    printf("Nom de la salle: ");
    scanf(" %[^\n]", nouvelle_salle.nom);
    
    printf("CapacitÃ© (nombre de personnes): ");
    scanf("%d", &nouvelle_salle.capacite);
    
    printf("Tarif horaire (TND): ");
    scanf("%f", &nouvelle_salle.tarif_horaire);
    
    printf("Ã‰quipements (sÃ©parÃ©s par des virgules): ");
    scanf(" %[^\n]", nouvelle_salle.equipements);
    
    salles[nb_salles] = nouvelle_salle;
    nb_salles++;
    
    printf("\nâœ… Salle ajoutÃ©e avec succÃ¨s!\n");
    pause_screen();
}
int trouver_salle(const char *nom) {
    for (int i = 0; i < nb_salles; i++) {
        if (strcmp(salles[i].nom, nom) == 0) {
            return i;
        }
    }
    return -1;
}

int periodes_se_chevauchent(const char *debut1, const char *fin1, 
                            const char *debut2, const char *fin2) {
    int h1d, m1d, h1f, m1f, h2d, m2d, h2f, m2f;
    
    sscanf(debut1, "%d:%d", &h1d, &m1d);
    sscanf(fin1, "%d:%d", &h1f, &m1f);
    sscanf(debut2, "%d:%d", &h2d, &m2d);
    sscanf(fin2, "%d:%d", &h2f, &m2f);
    
    int min1d = h1d * 60 + m1d;
    int min1f = h1f * 60 + m1f;
    int min2d = h2d * 60 + m2d;
    int min2f = h2f * 60 + m2f;
    
    return (min1d < min2f && min1f > min2d);
}

int verifier_disponibilite(const char *nom_salle, const char *date, 
                           const char *heure_debut, const char *heure_fin) {
    for (int i = 0; i < nb_reservations; i++) {
        if (strcmp(reservations[i].nom_salle, nom_salle) == 0 &&
            strcmp(reservations[i].date, date) == 0 &&
            strcmp(reservations[i].statut, "confirmÃ©e") == 0) {
            
            if (periodes_se_chevauchent(heure_debut, heure_fin,
                                       reservations[i].heure_debut,
                                       reservations[i].heure_fin)) {
                return 0;  
            }
        }
    }
    return 1; 
}

float calculer_cout(int index_salle, const char *heure_debut, const char *heure_fin) {
    float duree = calculer_duree(heure_debut, heure_fin);
    return duree * salles[index_salle].tarif_horaire;
}

void creer_reservation() {
    clearScreen();
    printf("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n");
    printf("â•‘              CRÃ‰ER UNE NOUVELLE RÃ‰SERVATION                   â•‘\n");
    printf("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n");
    
    if (nb_salles == 0) {
        printf("âŒ Aucune salle disponible. Veuillez d'abord ajouter des salles.\n");
        pause_screen();
        return;
    }
    
    if (nb_reservations >= 500) {
        printf("âŒ Limite de rÃ©servations atteinte!\n");
        pause_screen();
        return;
    }
    
    Reservation nouvelle_res;
    nouvelle_res.id = nb_reservations + 1;
    
    printf("Nom du client: ");
    scanf(" %[^\n]", nouvelle_res.nom_client);
   
    printf("\nSalles disponibles:\n");
    for (int i = 0; i < nb_salles; i++) {
        printf("  %d. %s (CapacitÃ©: %d, Tarif: %.2f TND/h)\n", 
               i+1, salles[i].nom, salles[i].capacite, salles[i].tarif_horaire);
    }
    
    int choix_salle;
    printf("\nChoisissez une salle (1-%d): ", nb_salles);
    scanf("%d", &choix_salle);
    
    if (choix_salle < 1 || choix_salle > nb_salles) {
        printf("âŒ Choix invalide!\n");
        pause_screen();
        return;
    }
    
    int index_salle = choix_salle - 1;
    nouvelle_res.id_salle = salles[index_salle].id;
    strcpy(nouvelle_res.nom_salle, salles[index_salle].nom);
    
    printf("Date (YYYY-MM-DD): ");
    scanf("%s", nouvelle_res.date);
    
    printf("Heure de dÃ©but (HH:MM): ");
    scanf("%s", nouvelle_res.heure_debut);
    
    printf("Heure de fin (HH:MM): ");
    scanf("%s", nouvelle_res.heure_fin);
    
    printf("Nombre de personnes: ");
    scanf("%d", &nouvelle_res.nombre_personnes);
    
    if (nouvelle_res.nombre_personnes > salles[index_salle].capacite) {
        printf("\nâŒ CAPACITÃ‰ INSUFFISANTE!\n");
        printf("La salle %s a une capacitÃ© de %d personnes.\n", 
               salles[index_salle].nom, salles[index_salle].capacite);
        pause_screen();
        return;
    }

    if (!verifier_disponibilite(nouvelle_res.nom_salle, nouvelle_res.date,
                                nouvelle_res.heure_debut, nouvelle_res.heure_fin)) {
        printf("\nâŒ CONFLIT DE RÃ‰SERVATION!\n");
        printf("La salle n'est pas disponible pour cette pÃ©riode.\n");
        pause_screen();
        return;
    }
   
    nouvelle_res.tarif = calculer_cout(index_salle, nouvelle_res.heure_debut, 
                                       nouvelle_res.heure_fin);
    
    strcpy(nouvelle_res.statut, "confirmÃ©e");
    
    reservations[nb_reservations] = nouvelle_res;
    nb_reservations++;
    
    printf("\nâœ… RÃ‰SERVATION CONFIRMÃ‰E!\n");
    printf("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
    printf("Client: %s\n", nouvelle_res.nom_client);
    printf("Salle: %s\n", nouvelle_res.nom_salle);
    printf("Date: %s\n", nouvelle_res.date);
    printf("Horaire: %s - %s\n", nouvelle_res.heure_debut, nouvelle_res.heure_fin);
    printf("DurÃ©e: %.2f heures\n", calculer_duree(nouvelle_res.heure_debut, nouvelle_res.heure_fin));
    printf("CoÃ»t total: %.2f TND\n", nouvelle_res.tarif);
    printf("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
    
    pause_screen();
}

void afficher_reservations() {
    clearScreen();
    printf("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n");
    printf("â•‘                 LISTE DES RÃ‰SERVATIONS                        â•‘\n");
    printf("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n");
    
    if (nb_reservations == 0) {
        printf("Aucune rÃ©servation enregistrÃ©e.\n");
        pause_screen();
        return;
    }
    
    for (int i = 0; i < nb_reservations; i++) {
        printf("â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n");
        printf("â”‚ ID: %d\n", reservations[i].id);
        printf("â”‚ Client: %s\n", reservations[i].nom_client);
        printf("â”‚ Salle: %s\n", reservations[i].nom_salle);
        printf("â”‚ Date: %s\n", reservations[i].date);
        printf("â”‚ Horaire: %s - %s\n", reservations[i].heure_debut, reservations[i].heure_fin);
        printf("â”‚ Personnes: %d\n", reservations[i].nombre_personnes);
        printf("â”‚ CoÃ»t: %.2f TND\n", reservations[i].tarif);
        printf("â”‚ Statut: %s\n", reservations[i].statut);
        printf("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n");
    }
    
    pause_screen();
}

void generer_facture() {
    clearScreen();
    printf("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n");
    printf("â•‘                   GÃ‰NÃ‰RER UNE FACTURE                         â•‘\n");
    printf("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n");
    
    if (nb_reservations == 0) {
        printf("âŒ Aucune rÃ©servation disponible.\n");
        pause_screen();
        return;
    }
    
    // Afficher les rÃ©servations
    printf("RÃ©servations disponibles:\n");
    for (int i = 0; i < nb_reservations; i++) {
        if (strcmp(reservations[i].statut, "confirmÃ©e") == 0) {
            printf("  %d. %s - %s - %s (%.2f TND)\n", 
                   reservations[i].id,
                   reservations[i].nom_client,
                   reservations[i].nom_salle,
                   reservations[i].date,
                   reservations[i].tarif);
        }
    }
    
    int id_res;
    printf("\nEntrez l'ID de la rÃ©servation: ");
    scanf("%d", &id_res);

    int index = -1;
    for (int i = 0; i < nb_reservations; i++) {
        if (reservations[i].id == id_res) {
            index = i;
            break;
        }
    }
    
    if (index == -1) {
        printf("âŒ RÃ©servation non trouvÃ©e!\n");
        pause_screen();
        return;
    }
    
    Facture nouvelle_facture;
    nouvelle_facture.id = nb_factures + 1;
    sprintf(nouvelle_facture.numero, "FACT-%d", nouvelle_facture.id);
    strcpy(nouvelle_facture.nom_client, reservations[index].nom_client);
    strcpy(nouvelle_facture.nom_salle, reservations[index].nom_salle);
    strcpy(nouvelle_facture.date, reservations[index].date);
    nouvelle_facture.duree = calculer_duree(reservations[index].heure_debut, 
                                           reservations[index].heure_fin);
    nouvelle_facture.montant = reservations[index].tarif;
    get_current_date(nouvelle_facture.date_emission);
    
    factures[nb_factures] = nouvelle_facture;
    nb_factures++;
    
    // Afficher la facture
    printf("\n");
    printf("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n");
    printf("â•‘                         FACTURE                               â•‘\n");
    printf("â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\n");
    printf("â•‘ NumÃ©ro: %-52s â•‘\n", nouvelle_facture.numero);
    printf("â•‘ Date d'Ã©mission: %-43s â•‘\n", nouvelle_facture.date_emission);
    printf("â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\n");
    printf("â•‘ Client: %-52s â•‘\n", nouvelle_facture.nom_client);
    printf("â•‘ Salle: %-53s â•‘\n", nouvelle_facture.nom_salle);
    printf("â•‘ Date de rÃ©servation: %-39s â•‘\n", nouvelle_facture.date);
    printf("â•‘ DurÃ©e: %.2f heures %-41s â•‘\n", nouvelle_facture.duree, "");
    printf("â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\n");
    printf("â•‘ MONTANT TOTAL: %.2f TND %-35s â•‘\n", nouvelle_facture.montant, "");
    printf("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
    
    printf("\nâœ… Facture gÃ©nÃ©rÃ©e avec succÃ¨s!\n");
    pause_screen();
}

void afficher_factures() {
    clearScreen();
    printf("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n");
    printf("â•‘                   LISTE DES FACTURES                          â•‘\n");
    printf("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n");
    
    if (nb_factures == 0) {
        printf("Aucune facture gÃ©nÃ©rÃ©e.\n");
        pause_screen();
        return;
    }
    
    for (int i = 0; i < nb_factures; i++) {
        printf("â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n");
        printf("â”‚ NumÃ©ro: %s\n", factures[i].numero);
        printf("â”‚ Client: %s\n", factures[i].nom_client);
        printf("â”‚ Salle: %s\n", factures[i].nom_salle);
        printf("â”‚ Date: %s\n", factures[i].date);
        printf("â”‚ DurÃ©e: %.2f heures\n", factures[i].duree);
        printf("â”‚ Montant: %.2f TND\n", factures[i].montant);
        printf("â”‚ Ã‰mise le: %s\n", factures[i].date_emission);
        printf("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n");
    }
    
    pause_screen();
}

void afficher_statistiques() {
    clearScreen();
    printf("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n");
    printf("â•‘                      STATISTIQUES                             â•‘\n");
    printf("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n");
    
    if (nb_reservations == 0) {
        printf("Aucune donnÃ©e disponible.\n");
        pause_screen();
        return;
    }

    printf("ğŸ“Š CHIFFRE D'AFFAIRES PAR SALLE\n");
    printf("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
    
    float ca_par_salle[100] = {0};
    for (int i = 0; i < nb_reservations; i++) {
        if (strcmp(reservations[i].statut, "confirmÃ©e") == 0) {
            for (int j = 0; j < nb_salles; j++) {
                if (strcmp(reservations[i].nom_salle, salles[j].nom) == 0) {
                    ca_par_salle[j] += reservations[i].tarif;
                    break;
                }
            }
        }
    }
    
    for (int i = 0; i < nb_salles; i++) {
        if (ca_par_salle[i] > 0) {
            printf("  %s: %.2f TND\n", salles[i].nom, ca_par_salle[i]);
        }
    }
    
    printf("\nğŸ“… RÃ‰SERVATIONS PAR MOIS\n");
    printf("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
    
    char mois[50][8];
    int count_mois[50] = {0};
    int nb_mois = 0;
    
    for (int i = 0; i < nb_reservations; i++) {
        char mois_res[8];
        strncpy(mois_res, reservations[i].date, 7);
        mois_res[7] = '\0';
        
        int trouve = 0;
        for (int j = 0; j < nb_mois; j++) {
            if (strcmp(mois[j], mois_res) == 0) {
                count_mois[j]++;
                trouve = 1;
                break;
            }
        }
        
        if (!trouve) {
            strcpy(mois[nb_mois], mois_res);
            count_mois[nb_mois] = 1;
            nb_mois++;
        }
    }
    
    for (int i = 0; i < nb_mois; i++) {
        printf("  %s: %d rÃ©servations\n", mois[i], count_mois[i]);
    }
  
    printf("\nâ­ SALLES LES PLUS POPULAIRES\n");
    printf("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
    
    int popularite[100] = {0};
    for (int i = 0; i < nb_reservations; i++) {
        for (int j = 0; j < nb_salles; j++) {
            if (strcmp(reservations[i].nom_salle, salles[j].nom) == 0) {
                popularite[j]++;
                break;
            }
        }
    }
    
    for (int i = 0; i < nb_salles - 1; i++) {
        for (int j = 0; j < nb_salles - i - 1; j++) {
            if (popularite[j] < popularite[j + 1]) {
                // Ã‰changer les popularitÃ©s
                int temp_pop = popularite[j];
                popularite[j] = popularite[j + 1];
                popularite[j + 1] = temp_pop;
                
                // Ã‰changer les salles
                Salle temp_salle = salles[j];
                salles[j] = salles[j + 1];
                salles[j + 1] = temp_salle;
            }
        }
    }
    
    for (int i = 0; i < nb_salles; i++) {
        if (popularite[i] > 0) {
            printf("  %d. %s: %d rÃ©servations\n", i+1, salles[i].nom, popularite[i]);
        }
    }
    
    pause_screen();
}

void sauvegarder_donnees() {
    FILE *f_salles = fopen("salles.dat", "wb");
    if (f_salles != NULL) {
        fwrite(&nb_salles, sizeof(int), 1, f_salles);
        fwrite(salles, sizeof(Salle), nb_salles, f_salles);
        fclose(f_salles);
    }

    FILE *f_res = fopen("reservations.dat", "wb");
    if (f_res != NULL) {
        fwrite(&nb_reservations, sizeof(int), 1, f_res);
        fwrite(reservations, sizeof(Reservation), nb_reservations, f_res);
        fclose(f_res);
    }
    
    FILE *f_fact = fopen("factures.dat", "wb");
    if (f_fact != NULL) {
        fwrite(&nb_factures, sizeof(int), 1, f_fact);
        fwrite(factures, sizeof(Facture), nb_factures, f_fact);
        fclose(f_fact);
    }
    
    printf("âœ… DonnÃ©es sauvegardÃ©es avec succÃ¨s!\n");
}

void charger_donnees() {
    FILE *f_salles = fopen("salles.dat", "rb");
    if (f_salles != NULL) {
        fread(&nb_salles, sizeof(int), 1, f_salles);
        fread(salles, sizeof(Salle), nb_salles, f_salles);
        fclose(f_salles);
    }

    FILE *f_res = fopen("reservations.dat", "rb");
    if (f_res != NULL) {
        fread(&nb_reservations, sizeof(int), 1, f_res);
        fread(reservations, sizeof(Reservation), nb_reservations, f_res);
        fclose(f_res);
    }
    
    // Charger les factures
    FILE *f_fact = fopen("factures.dat", "rb");
    if (f_fact != NULL) {
        fread(&nb_factures, sizeof(int), 1, f_fact);
        fread(factures, sizeof(Facture), nb_factures, f_fact);
        fclose(f_fact);
    }
}

void afficher_menu() {
    clearScreen();
    printf("\n");
    printf("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n");
    printf("â•‘                                                               â•‘\n");
    printf("â•‘      SYSTÃˆME DE GESTION DE RÃ‰SERVATIONS                       â•‘\n");
    printf("â•‘      Ã‰cole Nationale des Sciences de l'Informatique           â•‘\n");
    printf("â•‘                                                               â•‘\n");
    printf("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
    printf("\n");
    printf("â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n");
    printf("â”‚                    GESTION DES SALLES                         â”‚\n");
    printf("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n");
    printf("â”‚  1. Ajouter une salle                                         â”‚\n");
    printf("â”‚  2. Afficher les salles                                       â”‚\n");
    printf("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n");
    printf("â”‚                 GESTION DES RÃ‰SERVATIONS                      â”‚\n");
    printf("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n");
    printf("â”‚  3. CrÃ©er une rÃ©servation                                     â”‚\n");
    printf("â”‚  4. Afficher les rÃ©servations                                 â”‚\n");
    printf("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n");
    printf("â”‚                  GESTION DES FACTURES                         â”‚\n");
    printf("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n");
    printf("â”‚  5. GÃ©nÃ©rer une facture                                       â”‚\n");
    printf("â”‚  6. Afficher les factures                                     â”‚\n");
    printf("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n");
    printf("â”‚                     STATISTIQUES                              â”‚\n");
    printf("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n");
    printf("â”‚  7. Afficher les statistiques                                 â”‚\n");
    printf("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n");
    printf("â”‚                   SAUVEGARDE & QUITTER                        â”‚\n");
    printf("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n");
    printf("â”‚  8. Sauvegarder les donnÃ©es                                   â”‚\n");
    printf("â”‚  0. Quitter                                                   â”‚\n");
    printf("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n");
    printf("\nVotre choix: ");
    }
int main() {
int choix;

#ifdef _WIN32
    SetConsoleOutputCP(CP_UTF8);
    SetConsoleCP(CP_UTF8);
#endif

    charger_donnees();

do {
    afficher_menu();
    scanf("%d", &choix);
    
    switch(choix) {
        case 1:
            ajouter_salle();
            break;
        case 2:
            afficher_salles();
            pause_screen();
            break;
        case 3:
            creer_reservation();
            break;
        case 4:
            afficher_reservations();
            break;
        case 5:
            generer_facture();
            break;
        case 6:
            afficher_factures();
            break;
        case 7:
            afficher_statistiques();
            break;
        case 8:
            sauvegarder_donnees();
            pause_screen();
            break;
        case 0:
            printf("\nğŸ’¾ Sauvegarde automatique en cours...\n");
            sauvegarder_donnees();
            printf("\nğŸ‘‹ Merci d'avoir utilisÃ© le systÃ¨me!\n");
            printf("Au revoir!\n\n");
            break;
        default:
            printf("\nâŒ Choix invalide! RÃ©essayez.\n");
            pause_screen();
    }
} while(choix != 0);

return 0;
}
